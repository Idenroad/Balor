#!/usr/bin/env bash

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Source common functions
source "$ROOT_DIR/lib/common.sh"

echo ""
echo "=========================================="
echo " $WEBEXPLOIT_INSTALL_TITLE"
echo "=========================================="
echo ""

# Ensure AUR helper (paru) is available
ensure_aur_helper

# Read packages from packages.txt
packages_data=$(read_stack_packages "$SCRIPT_DIR")
IFS='|' read -r pacman_list aur_list <<< "$packages_data"

# Install pacman packages
if [[ -n "$pacman_list" ]]; then
  echo ""
  echo "$INSTALL_PACMAN_PACKAGES"
  for pkg in $pacman_list; do
    install_pacman_pkg "$pkg"
  done
fi

# Install AUR packages
if [[ -n "$aur_list" ]]; then
  echo ""
  echo "$INSTALL_AUR_PACKAGES"
  for pkg in $aur_list; do
    install_aur_pkg "$pkg"
  done
fi

echo ""
echo "=========================================="
echo " Stack Web Exploit installée!"
echo "=========================================="
echo ""
echo "Outils installés: gobuster, sqlmap, hydra, nikto, whatweb, csrf-brute, ffuf"
echo ""
echo "Quick start commands:"
echo "  gobuster dir -u <url> -w <wordlist>    # Directory brute-forcing"
echo "  sqlmap -u <url>                        # SQL injection testing"
echo "  hydra -l <user> -P <passlist> <target> <service>  # Login brute-force"
echo "  nikto -h <target>                      # Web server vulnerability scan"
echo "  whatweb <url>                          # Web tech fingerprinting"
echo "  ffuf -u <url>/FUZZ -w <wordlist>       # Fast web fuzzer"
echo ""
echo "[!] Utilisez ces outils dans un cadre légal !"
echo ""
